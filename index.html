<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>El juego de CÃ©sar - Moderno y Responsive</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  
  <style>
    /* Variables para temas */
    :root {
      --color-bg-light: #f0f2f5;
      --color-text-light: #222;
      --color-primary-light: #4a90e2;

      --color-bg-dark: #121212;
      --color-text-dark: #eee;
      --color-primary-dark: #90caf9;

      --transition-time: 0.4s;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
      transition: background-color var(--transition-time), color var(--transition-time);
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    body.dark {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }

    .top-bar {
      margin-top: 20px;
      font-weight: 700;
      font-size: 18px;
      max-width: 600px;
      width: 90%;
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }
    .time-record {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    #timer {
      font-family: 'Courier New', Courier, monospace;
      font-size: 28px;
      font-weight: 900;
      color: var(--color-primary-light);
      padding: 6px 14px;
      border-radius: 12px;
      background: rgba(74, 144, 226, 0.15);
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.5);
      min-width: 90px;
      text-align: center;
      user-select: none;
      transition: color var(--transition-time), background var(--transition-time);
    }
    body.dark #timer {
      color: var(--color-primary-dark);
      background: rgba(144, 202, 249, 0.15);
      box-shadow: 0 0 8px rgba(144, 202, 249, 0.5);
    }

    #best-time {
      font-size: 20px;
      color: inherit;
    }

    .main-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 50px;
      margin-top: 40px;
      flex-wrap: wrap;
      max-width: 900px;
      width: 90%;
    }

    .phrase {
      flex: 1;
      font-size: 2.8rem;
      font-weight: 700;
      max-width: 320px;
      text-align: left;
      user-select: none;
      color: inherit;
    }

    .board {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 6px;
      width: max-content;
      opacity: 0;
      animation: fadeIn 0.6s forwards;
    }

    .token {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      cursor: pointer;
      border-radius: 8px;
      user-select: none;
      color: var(--color-text-light);
      background-color: var(--color-primary-light);
      box-shadow: 0 4px 8px rgba(74, 144, 226, 0.4);
      transition: box-shadow 0.3s, transform 0.3s;
    }
    body.dark .token {
      color: var(--color-text-dark);
      background-color: var(--color-primary-dark);
      box-shadow: 0 4px 8px rgba(144, 202, 249, 0.4);
    }
    .token:hover {
      box-shadow: 0 6px 14px rgba(255, 140, 0, 0.7);
      transform: translateY(-6px);
    }
    .token.moved {
      animation: bounce 0.3s;
    }

    .empty {
      width: 100px;
      height: 100px;
      border: 2px dashed #bbb;
      border-radius: 8px;
      background: transparent;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .victory-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ff9800;
      padding: 30px;
      border-radius: 12px;
      font-size: 32px;
      font-weight: 700;
      box-shadow: 0 0 20px #ff9800;
      display: none;
      color: white;
      text-shadow:
         0 0 8px #fff,
         0 0 16px #ffc107,
         0 0 24px #ff9800,
         0 0 32px #ff9800;
      animation: pop 0.5s ease, glow 2s infinite alternate;
      user-select: none;
      z-index: 9999;
    }

    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    @keyframes glow {
      from {
        text-shadow:
         0 0 8px #fff,
         0 0 16px #ffc107,
         0 0 24px #ff9800,
         0 0 32px #ff9800;
      }
      to {
        text-shadow:
         0 0 16px #fff,
         0 0 24px #ffc107,
         0 0 32px #ff9800,
         0 0 40px #ff9800;
      }
    }

    .buttons {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 12px;
      width: 100%;
      max-width: 900px;
    }

    .buttons button {
      font-size: 18px;
      cursor: pointer;
      padding: 10px 28px;
      border-radius: 10px;
      border: none;
      background-color: var(--color-primary-light);
      color: white;
      font-weight: 700;
      transition: background-color 0.3s, box-shadow 0.3s;
      user-select: none;
      box-shadow: 0 4px 8px rgba(74, 144, 226, 0.5);
      flex-grow: 1;
      max-width: 160px;
    }
    body.dark .buttons button {
      background-color: var(--color-primary-dark);
      box-shadow: 0 4px 8px rgba(144, 202, 249, 0.5);
    }
    .buttons button:hover {
      background-color: #ff6f00;
      box-shadow: 0 6px 16px #ff6f00;
    }

    /* Responsive */
    @media (max-width: 750px) {
      .main-content {
        flex-direction: column;
        gap: 30px;
      }
      .phrase {
        font-size: 2.2rem;
        max-width: 100%;
        text-align: center;
      }
      .board {
        grid-template-columns: repeat(3, 80px);
      }
      .token, .empty {
        width: 80px;
        height: 80px;
        font-size: 32px;
      }
      .buttons {
        max-width: 320px;
        margin: 20px auto 0;
      }
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <div class="time-record">
      Tiempo: <span id="timer">00:00</span> | Record: <span id="best-time">-</span> s
    </div>
  </div>

  <div class="main-content">
    <div class="phrase">Â¡DesafÃ­a tu mente y diviÃ©rtete!</div>
    <div class="board"></div>
  </div>

  <div class="buttons">
    <button id="change-theme" title="Cambiar tema">Cambiar tema</button>
  </div>

  <div class="victory-message" id="victory-message">ðŸŽ‰ Â¡Victoria! ðŸŽ‰</div>

  <script>
    // Variables
    let matrix = [
      ["1", "2", "3"],
      ["4", "5", "6"],
      ["7", "8", ""]
    ];

    const board = document.querySelector('.board');
    const timerDisplay = document.getElementById('timer');
    const bestTimeDisplay = document.getElementById('best-time');
    const victoryMessage = document.getElementById('victory-message');
    const changeThemeBtn = document.getElementById('change-theme');

    let empty = findEmpty();
    let timerInterval;
    let timeElapsed = 0;
    let gameStarted = false;

    let bestTime = localStorage.getItem('bestTime');
    if (bestTime) {
      bestTimeDisplay.textContent = formatTime(bestTime);
    }

    // Detectar preferencia del sistema para tema oscuro/claro
    function detectColorScheme() {
      if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      } else {
        document.body.classList.remove('dark');
      }
    }
    detectColorScheme();

    // Permitir cambiar tema manual (oscuro/claro)
    changeThemeBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    // Funciones del juego
    function findEmpty() {
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < 3; c++) {
          if (matrix[r][c] === "") return { r, c };
        }
      }
      return { r: 2, c: 2 };
    }

    function drawTokens() {
      board.innerHTML = "";
      matrix.forEach((row, r) => {
        row.forEach((el, c) => {
          const cell = document.createElement('div');
          cell.dataset.r = r;
          cell.dataset.c = c;
          if (el === "") {
            cell.className = "empty";
          } else {
            cell.className = "token";
            cell.textContent = el;
            cell.addEventListener("click", onTileClick);
          }
          board.appendChild(cell);
        });
      });
      board.style.animation = "fadeIn 0.6s forwards";
    }

    function isAdjacent(r1, c1, r2, c2) {
      return Math.abs(r1 - r2) + Math.abs(c1 - c2) === 1;
    }

    function formatTime(seconds) {
      const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${mins}:${secs}`;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timeElapsed++;
        timerDisplay.textContent = formatTime(timeElapsed);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function onTileClick() {
      if (!gameStarted) {
        gameStarted = true;
        startTimer();
      }

      const r = Number(this.dataset.r);
      const c = Number(this.dataset.c);
      if (isAdjacent(r, c, empty.r, empty.c)) {
        // Mover ficha y animar rebote
        matrix[empty.r][empty.c] = matrix[r][c];
        matrix[r][c] = "";
        empty = { r, c };
        drawTokens();

        // AÃ±adir clase de animaciÃ³n al Ãºltimo token movido
        const tokens = board.querySelectorAll('.token');
        tokens.forEach(token => token.classList.remove('moved'));
        const movedToken = Array.from(tokens).find(t => Number(t.dataset.r) === empty.r && Number(t.dataset.c) === empty.c);
        if (movedToken) {
          movedToken.classList.add('moved');
        }

        if (checkWin()) {
          stopTimer();
          setTimeout(showVictory, 200);

          if (!bestTime || timeElapsed < bestTime) {
            bestTime = timeElapsed;
            localStorage.setItem('bestTime', bestTime);
            bestTimeDisplay.textContent = formatTime(bestTime);
          }
        }
      }
    }

    function showVictory() {
      victoryMessage.style.display = 'block';
      setTimeout(() => {
        victoryMessage.style.display = 'none';
        resetGame();
      }, 3000);
    }

    function shuffle(times = 200) {
      for (let i = 0; i < times; i++) {
        const neighbors = [];
        const deltas = [
          [1, 0],
          [-1, 0],
          [0, 1],
          [0, -1]
        ];
        for (const [dr, dc] of deltas) {
          const nr = empty.r + dr;
          const nc = empty.c + dc;
          if (nr >= 0 && nr < 3 && nc >= 0 && nc < 3) neighbors.push({ nr, nc });
        }
        const pick = neighbors[Math.floor(Math.random() * neighbors.length)];
        matrix[empty.r][empty.c] = matrix[pick.nr][pick.nc];
        matrix[pick.nr][pick.nc] = "";
        empty = { r: pick.nr, c: pick.nc };
      }
    }

    function checkWin() {
      const solved = ["1", "2", "3", "4", "5", "6", "7", "8", ""];
      const flat = matrix.flat();
      return flat.join(",") === solved.join(",");
    }

    function resetGame() {
      matrix = [
        ["1", "2", "3"],
        ["4", "5", "6"],
        ["7", "8", ""]
      ];
      empty = findEmpty();
      shuffle();
      drawTokens();
      timeElapsed = 0;
      timerDisplay.textContent = formatTime(0);
      gameStarted = false;
    }

    // InicializaciÃ³n
    empty = findEmpty();
    shuffle();
    drawTokens();

  </script>

</body>
</html>